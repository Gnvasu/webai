<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="UTF-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<title>Go Gt Ai - ನಮಸ್ಕಾರ & Namaste</title>
		<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
		<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
		<script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
		<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/styles/github-dark.min.css">
		<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/highlight.min.js"></script>
		<style>
			/* Light theme (default) styles */
			:root {
				--bg-gradient: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
				--container-bg: rgba(255, 255, 255, 0.95);
				--text-color: #2c3e50;
				--input-bg: white;
				--input-border: #ddd;
				--code-bg: #f8f9fa;
				--code-color: #2563eb;
				--footer-bg: rgba(255, 255, 255, 0.9);
				--footer-color: #667eea;
				--switch-bg: rgba(255, 255, 255, 0.9);
			}

			/* Dark theme styles */
			[data-theme="dark"] {
				--bg-gradient: linear-gradient(135deg, #1a1c20 0%, #2c3e50 100%);
				--container-bg: rgba(30, 32, 36, 0.95);
				--text-color: #e0e0e0;
				--input-bg: #2c3e50;
				--input-border: #4a5568;
				--code-bg: #2d3748;
				--code-color: #90cdf4;
				--footer-bg: rgba(30, 32, 36, 0.9);
				--footer-color: #90cdf4;
				--switch-bg: rgba(30, 32, 36, 0.9);
			}

			body {
				background: var(--bg-gradient);
				min-height: 100vh;
				padding: 20px 0;
				margin: 0;
				font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;
				color: var(--text-color);
			}

			.container {
				background: var(--container-bg);
				color: var(--text-color);
			}

			.input-group {
				background: var(--input-bg);
			}

			#userInput {
				color: var(--text-color);
				background: transparent;
			}

			.model-selector select {
				background: var(--input-bg);
				color: var(--text-color);
				border-color: var(--input-border);
			}

			.response-text {
				color: var(--text-color);
			}

			.response-text code {
				background-color: var(--code-bg);
				color: var(--code-color);
			}

			.response-text pre {
				background-color: var(--code-bg);
				border-color: var(--input-border);
			}

			.footer {
				background: var(--footer-bg);
				color: var(--footer-color);
			}

			.theme-switch-container {
				background: var(--switch-bg);
			}

			.auto-switch-label {
				color: var(--text-color);
			}

			/* Theme switcher styles */
			.theme-switch-container {
				position: fixed;
				top: 20px;
				right: 20px;
				z-index: 1000;
				display: flex;
				align-items: center;
				gap: 8px;
				padding: 8px 12px;
				border-radius: 20px;
				box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
				backdrop-filter: blur(5px);
			}

			.theme-switch {
				position: relative;
				display: inline-block;
				width: 60px;
				height: 34px;
			}

			.theme-switch input {
				opacity: 0;
				width: 0;
				height: 0;
			}

			.theme-slider {
				position: absolute;
				cursor: pointer;
				top: 0;
				left: 0;
				right: 0;
				bottom: 0;
				background-color: #2c3e50;
				transition: .4s;
				border-radius: 34px;
				display: flex;
				align-items: center;
				justify-content: space-between;
				padding: 5px;
			}

			.theme-slider:before {
				position: absolute;
				content: "";
				height: 26px;
				width: 26px;
				left: 4px;
				bottom: 4px;
				background-color: white;
				transition: .4s;
				border-radius: 50%;
				z-index: 2;
			}

			input:checked + .theme-slider {
				background-color: #f0f0f0;
			}

			input:checked + .theme-slider:before {
				transform: translateX(26px);
				background-color: #2c3e50;
			}

			.theme-icons {
				position: relative;
				z-index: 1;
				color: #f0f0f0;
				font-size: 14px;
				width: 20px;
				text-align: center;
			}

			input:checked + .theme-slider .theme-icons {
				color: #2c3e50;
			}

			.container {
				max-width: 800px;
				margin: 0 auto;
				padding: 20px;
				border-radius: 15px;
				box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
				position: relative;
				min-height: calc(100vh - 140px);
			}

			.header {
				text-align: center;
				margin-bottom: 30px;
				padding: 20px;
				background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
				border-radius: 10px;
				color: white;
			}

			.header h2 {
				font-size: 2.5em;
				margin-bottom: 10px;
				font-weight: bold;
				text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.2);
			}

			.header h3 {
				font-size: 1.8em;
				margin-bottom: 15px;
				color: #f0f0f0;
			}

			.header p {
				margin: 5px 0;
				font-size: 1.1em;
			}

			.input-container {
				margin: 20px 0;
				position: relative;
			}

			.model-selector {
				margin-bottom: 15px;
				display: flex;
				align-items: center;
				gap: 15px;
				flex-wrap: wrap;
			}

			.model-selector select {
				flex: 1;
				min-width: 200px;
				padding: 12px;
				border-radius: 10px;
				border: 1px solid #ddd;
				background: white;
				color: #2c3e50;
				font-size: 1em;
				cursor: pointer;
				transition: all 0.3s ease;
				box-shadow: 0 2px 5px rgba(0,0,0,0.05);
			}

			.model-selector select:hover {
				border-color: #667eea;
			}

			.model-selector select:focus {
				outline: none;
				border-color: #667eea;
				box-shadow: 0 0 0 2px rgba(102,126,234,0.2);
			}

			.input-group {
				background: white;
				border-radius: 25px;
				padding: 5px;
				box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
				display: flex;
				align-items: center;
			}

			#userInput {
				flex: 1;
				border: none;
				border-radius: 20px;
				padding: 15px 25px;
				font-size: 1.1em;
				background: transparent;
				min-height: 24px;
				max-height: 150px;
				resize: vertical;
			}

			.btn-send {
				border-radius: 20px !important;
				padding: 12px 30px !important;
				background: linear-gradient(135deg, #667eea 0%, #764ba2 100%) !important;
				border: none !important;
				font-weight: 600 !important;
				letter-spacing: 0.5px;
				transition: all 0.3s ease !important;
				white-space: nowrap;
				display: flex;
				align-items: center;
				gap: 8px;
			}

			.response-container {
				margin-bottom: 60px;
				padding-bottom: 20px;
			}

			.footer {
				text-align: center;
				padding: 15px;
				color: #667eea;
				font-weight: bold;
				font-size: 1.2em;
				text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.1);
				position: fixed;
				bottom: 0;
				left: 0;
				width: 100%;
				background: rgba(255, 255, 255, 0.9);
				backdrop-filter: blur(5px);
				z-index: 1000;
			}

			/* Mobile Responsive Design */
			@media (max-width: 768px) {
				body {
					padding: 10px;
				}

				.container {
					padding: 15px;
					margin: 0 10px;
					min-height: calc(100vh - 100px);
				}

				.header {
					padding: 15px;
					margin-bottom: 20px;
				}

				.header h2 {
					font-size: 2em;
				}

				.header h3 {
					font-size: 1.5em;
				}

				.model-selector {
					flex-direction: column;
					gap: 10px;
				}

				.model-selector select {
					width: 100%;
					min-width: unset;
				}

				.auto-switch-label {
					width: 100%;
					justify-content: center;
				}

				.input-group {
					flex-direction: column;
					gap: 10px;
					padding: 10px;
				}

				#userInput {
					width: 100%;
					padding: 12px;
					font-size: 1em;
				}

				.btn-send {
					width: 100%;
					justify-content: center;
					padding: 12px !important;
				}

				.response-container {
					margin-bottom: 80px;
				}

				.copy-btn {
					top: 10px;
					right: 10px;
					padding: 6px 12px;
					font-size: 0.8em;
				}

				.response-text {
					font-size: 1em;
					padding: 1em;
				}

				.footer {
					padding: 10px;
					font-size: 1em;
				}
			}

			/* Tablet Responsive Design */
			@media (min-width: 769px) and (max-width: 1024px) {
				.container {
					max-width: 90%;
				}

				.model-selector {
					gap: 10px;
				}

				.input-group {
					padding: 8px;
				}

				.btn-send {
					padding: 12px 20px !important;
				}
			}

			/* Large Screen Optimizations */
			@media (min-width: 1025px) {
				.container {
					max-width: 1000px;
				}

				.response-container {
					margin-bottom: 70px;
				}

				#userInput {
					font-size: 1.2em;
				}

				.btn-send {
					padding: 15px 35px !important;
				}
			}

			.typing-indicator {
				display: none;
				padding: 15px;
				background: white;
				border-radius: 10px;
				margin: 20px 0;
				text-align: center;
				box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
			}

			.typing-indicator span {
				display: inline-block;
				width: 10px;
				height: 10px;
				margin: 0 3px;
				background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
				border-radius: 50%;
				animation: typing 1s infinite ease-in-out;
			}

			.typing-indicator span:nth-child(2) { animation-delay: 0.2s; }
			.typing-indicator span:nth-child(3) { animation-delay: 0.4s; }

			@keyframes typing {
				0%, 100% { transform: translateY(0); }
				50% { transform: translateY(-10px); }
			}

			.response-text {
				line-height: 1.8;
				font-size: 1.1em;
				padding: 1.5em;
			}

			.response-text h1, .response-text h2, .response-text h3 {
				color: #2c3e50;
				margin-top: 1.5em;
				margin-bottom: 0.8em;
				padding-bottom: 0.3em;
				border-bottom: 2px solid #eaecef;
			}

			.response-text h1 {
				font-size: 1.8em;
			}

			.response-text h2 {
				font-size: 1.5em;
			}

			.response-text h3 {
				font-size: 1.3em;
			}

			.response-text p {
				margin-bottom: 1.2em;
				line-height: 1.8;
			}

			.response-text ul, .response-text ol {
				padding-left: 1.5em;
				margin: 1em 0;
			}

			.response-text li {
				margin-bottom: 0.8em;
				line-height: 1.6;
			}

			.response-text code {
				background-color: #f1f5f9;
				padding: 0.2em 0.4em;
				border-radius: 3px;
				font-size: 0.9em;
				color: #2563eb;
			}

			.response-text pre {
				margin: 1.5em 0;
				padding: 1.5em;
				background-color: #f8f9fa;
				border-radius: 8px;
				overflow-x: auto;
				border: 1px solid #e2e8f0;
			}

			.response-text pre code {
				background-color: transparent;
				padding: 0;
				color: #1e293b;
			}

			.response-text blockquote {
				background-color: #f8f9fa;
				border-left: 4px solid #667eea;
				padding: 1em 1.5em;
				margin: 1.5em 0;
				color: #2c3e50;
				font-style: italic;
			}

			.response-text table {
				border-collapse: collapse;
				width: 100%;
				margin: 1.5em 0;
				font-size: 0.9em;
			}

			.response-text th, .response-text td {
				border: 1px solid #e2e8f0;
				padding: 0.75em 1em;
				text-align: left;
			}

			.response-text th {
				background-color: #f8f9fa;
				font-weight: 600;
				color: #2c3e50;
			}

			.response-text tr:nth-child(even) {
				background-color: #f8f9fa;
			}

			.response-text img {
				max-width: 100%;
				height: auto;
				border-radius: 8px;
				margin: 1em 0;
			}

			.response-text hr {
				border: none;
				border-top: 2px solid #e2e8f0;
				margin: 2em 0;
			}

			.response-text a {
				color: #3498db;
				text-decoration: none;
				border-bottom: 1px solid transparent;
				transition: border-color 0.2s ease;
			}

			.response-text a:hover {
				border-bottom-color: #3498db;
			}

			.copy-btn {
				position: absolute;
				top: 15px;
				right: 15px;
				padding: 8px 15px;
				background: white;
				border: 2px solid #667eea;
				border-radius: 8px;
				color: #667eea;
				cursor: pointer;
				transition: all 0.3s ease;
				font-size: 0.9em;
				display: flex;
				align-items: center;
				gap: 5px;
			}

			.copy-btn:hover {
				background: #667eea;
				color: white;
				transform: translateY(-2px);
			}

			.copy-btn i {
				font-size: 1.1em;
			}

			.error-message {
				display: none;
				padding: 15px;
				background: #fee2e2;
				border-radius: 10px;
				color: #dc2626;
				margin: 20px 0;
				text-align: center;
				font-weight: 500;
			}

			/* Loading Animation */
			.loading-bar {
				height: 3px;
				width: 100%;
				position: relative;
				background: #f0f0f0;
				overflow: hidden;
				border-radius: 3px;
				margin-top: 10px;
			}

			.loading-bar::after {
				content: '';
				display: block;
				height: 100%;
				width: 40%;
				background: linear-gradient(90deg, #667eea, #764ba2);
				position: absolute;
				left: -40%;
				animation: loading 1s infinite ease-in-out;
			}

			@keyframes loading {
				from { left: -40%; }
				to { left: 100%; }
			}

			/* Auto-switch toggle styles */
			.switch {
				position: relative;
				display: inline-block;
				width: 60px;
				height: 34px;
			}

			.switch input {
				opacity: 0;
				width: 0;
				height: 0;
			}

			.slider {
				position: absolute;
				cursor: pointer;
				top: 0;
				left: 0;
				right: 0;
				bottom: 0;
				background-color: #ccc;
				transition: .4s;
				border-radius: 34px;
			}

			.slider:before {
				position: absolute;
				content: "";
				height: 26px;
				width: 26px;
				left: 4px;
				bottom: 4px;
				background-color: white;
				transition: .4s;
				border-radius: 50%;
			}

			input:checked + .slider {
				background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
			}

			input:checked + .slider:before {
				transform: translateX(26px);
			}

			.auto-switch-label {
				font-size: 0.9em;
				color: #2c3e50;
				display: flex;
				align-items: center;
				gap: 8px;
			}

			/* Mobile adjustments for theme switcher */
			@media (max-width: 768px) {
				.theme-switch-container {
					top: 10px;
					right: 10px;
					padding: 6px 10px;
				}
			}

			/* Add new styles for chat interface */
			.chat-container {
				display: flex;
				flex-direction: column;
				gap: 20px;
				margin-bottom: 80px;
			}

			.message {
				display: flex;
				gap: 15px;
				padding: 15px;
				border-radius: 18px;
				animation: fadeIn 0.4s ease-in;
				margin-bottom: 10px;
				max-width: 80%;
				position: relative;
				box-shadow: 0 2px 8px rgba(0,0,0,0.07);
			}
			.message.user {
				background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
				color: #fff;
				align-self: flex-end;
				border-bottom-right-radius: 4px;
			}
			.message.assistant {
				background: var(--container-bg);
				color: var(--text-color);
				align-self: flex-start;
				border-bottom-left-radius: 4px;
				border: 1px solid var(--input-border);
			}
			.message-avatar {
				width: 34px;
				height: 34px;
				border-radius: 50%;
				display: flex;
				align-items: center;
				justify-content: center;
				font-size: 1.4em;
				background: #fff;
				box-shadow: 0 1px 4px rgba(0,0,0,0.08);
			}
			.message.user .message-avatar {
				background: #764ba2;
				color: #fff;
			}
			.message.assistant .message-avatar {
				background: #e0e7ef;
				color: #667eea;
			}
			.message-content {
				flex: 1;
				word-break: break-word;
			}
			.message-timestamp {
				font-size: 0.8em;
				color: #aaa;
				margin-top: 5px;
				text-align: right;
			}
			.message-model {
				font-size: 0.8em;
				color: #667eea;
				font-weight: 600;
				margin-bottom: 2px;
			}
			@keyframes fadeIn {
				from { opacity: 0; transform: translateY(10px); }
				to { opacity: 1; transform: translateY(0); }
			}
			/* Typing indicator */
			.typing-indicator {
				display: flex;
				align-items: center;
				gap: 8px;
				padding: 10px 20px;
				background: var(--container-bg);
				border-radius: 12px;
				margin: 10px 0 10px 0;
				width: fit-content;
				box-shadow: 0 2px 8px rgba(0,0,0,0.07);
			}
			.typing-dot {
				width: 8px;
				height: 8px;
				background: #667eea;
				border-radius: 50%;
				display: inline-block;
				animation: typingBlink 1.2s infinite both;
			}
			.typing-dot:nth-child(2) { animation-delay: 0.2s; }
			.typing-dot:nth-child(3) { animation-delay: 0.4s; }
			@keyframes typingBlink {
				0%, 80%, 100% { opacity: 0.2; }
				40% { opacity: 1; }
			}
		</style>
	</head>
	<body>
		<div class="container">
			<div class="header">
				<h2>Go Gt Ai</h2>
				<h3>ನಮಸ್ಕಾರ & Namaste</h3>
				<p class="text-light">UNLIMITED & FREE</p>
				<p class="text-light">Powered by Advanced AI</p>
			</div>

			<div class="chat-container" id="chatContainer">
				<!-- Messages will be added here dynamically -->
			</div>

			<div class="input-container">
				<div class="model-selector">
					<select id="modelSelect" class="form-control">
						<option value="deepseek/deepseek-chat-v3-0324">DeepSeek V3 (Free)</option>
						<option value="deepseek/deepseek-r1">DeepSeek R1 (Free)</option>
						<option value="deepseek/deepseek-r1-0528">DeepSeek R1 0528 (Free)</option>
						<option value="google/gemini-2.0-flash-001">Gemini 2.0 Flash (Free)</option>
						<option value="deepseek/deepseek-r1-0528-qwen3-8b">DeepSeek R1 0528 Qwen3 8B (Free)</option>
						<option value="mistralai/devstral-small">Mistral Devstral Small (Free)</option>
						<option value="meta-llama/llama-3-8b-instruct">Meta Llama 3.3 8B Instruct (Free)</option>
						<option value="deepseek/deepseek-prover-v2">DeepSeek Prover V2 (Free)</option>
					</select>
					<div class="auto-switch-label">
						<label class="switch">
							<input type="checkbox" id="autoSwitch">
							<span class="slider"></span>
						</label>
						Auto Switch
					</div>
					<small class="text-success mt-2 d-block">
						<i class="fas fa-infinity"></i> Free AI models with generous usage limits
					</small>
				</div>
				<div class="input-group">
					<input type="text" class="form-control" id="userInput" 
						placeholder="Ask me anything..." />
					<div class="input-group-append">
						<button class="btn btn-primary btn-send" onclick="sendMessage()">
							<i class="fas fa-paper-plane"></i> Ask
						</button>
					</div>
				</div>
			</div>

			<div id="aiTyping" class="typing-indicator" style="display:none;">
				<span class="typing-dot"></span><span class="typing-dot"></span><span class="typing-dot"></span>
				<span style="margin-left:8px; color:#667eea; font-size:0.95em;">AI is typing...</span>
			</div>
			
			<div class="error-message"></div>
		</div>
		
		<div class="footer">
			Vasunex
		</div>

		<div class="theme-switch-container">
			<label class="theme-switch">
				<input type="checkbox" id="themeSwitch">
				<span class="theme-slider">
					<span class="theme-icons">☀️</span>
					<span class="theme-icons">🌙</span>
				</span>
			</label>
		</div>

		<script>
			// Constants for API keys
			const API_KEYS = {
				'deepseek/deepseek-chat-v3-0324': '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',
				'deepseek/deepseek-r1': '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',
				'deepseek/deepseek-r1-0528': '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',
				'google/gemini-2.0-flash-001': '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',
				'deepseek/deepseek-r1-0528-qwen3-8b': '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',
				'mistralai/devstral-small': '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',
				'meta-llama/llama-3-8b-instruct': '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',
				'deepseek/deepseek-prover-v2': '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'
			};

			// Cache for storing previous responses
			const responseCache = new Map();
			
			const typingIndicator = document.querySelector('.typing-indicator');
			const errorMessage = document.querySelector('.error-message');

			function showTyping() {
				document.getElementById('aiTyping').style.display = 'flex';
				errorMessage.style.display = 'none';
			}

			function hideTyping() {
				document.getElementById('aiTyping').style.display = 'none';
			}

			function showError(message) {
				errorMessage.textContent = message;
				errorMessage.style.display = 'block';
				typingIndicator.style.display = 'none';
			}

			// Function to get cached response
			function getCachedResponse(input) {
				return responseCache.get(input.toLowerCase().trim());
			}

			// Function to cache response
			function cacheResponse(input, response) {
				responseCache.set(input.toLowerCase().trim(), response);
				// Limit cache size to 50 entries
				if (responseCache.size > 50) {
					const firstKey = responseCache.keys().next().value;
					responseCache.delete(firstKey);
				}
			}

			async function copyResponse() {
				try {
					// Get the response text
					const responseElement = document.getElementById('response');
					let textToCopy = '';

					// Try different methods to get the text
					if (window.getSelection) {
						// Create a range and select the response div
						const range = document.createRange();
						range.selectNode(responseElement);
						window.getSelection().removeAllRanges();
						window.getSelection().addRange(range);
						
						// Try the new clipboard API first
						try {
							await navigator.clipboard.writeText(responseElement.innerText);
						} catch (err) {
							// Fallback to execCommand
							document.execCommand('copy');
						}
						
						// Clear the selection
						window.getSelection().removeAllRanges();
					} else {
						// Fallback for older browsers
						textToCopy = responseElement.innerText || responseElement.textContent;
						const textArea = document.createElement('textarea');
						textArea.value = textToCopy;
						document.body.appendChild(textArea);
						textArea.select();
						document.execCommand('copy');
						document.body.removeChild(textArea);
					}

					// Show success feedback
					const copyBtn = document.querySelector('.copy-btn');
					const originalContent = copyBtn.innerHTML;
					copyBtn.innerHTML = '<i class="fas fa-check"></i> Copied!';
					copyBtn.style.background = '#2ecc71';
					copyBtn.style.color = 'white';
					copyBtn.style.borderColor = '#2ecc71';
					
					setTimeout(() => {
						copyBtn.innerHTML = originalContent;
						copyBtn.style.background = '';
						copyBtn.style.color = '';
						copyBtn.style.borderColor = '';
					}, 2000);

				} catch (err) {
					console.error('Failed to copy:', err);
					
					// Try alternative copy method
					try {
						const text = document.getElementById('response').innerText;
						const textArea = document.createElement('textarea');
						textArea.value = text;
						textArea.style.position = 'fixed';
						textArea.style.left = '-9999px';
						document.body.appendChild(textArea);
						textArea.select();
						document.execCommand('copy');
						document.body.removeChild(textArea);
						
						// Show success message
						const copyBtn = document.querySelector('.copy-btn');
						const originalContent = copyBtn.innerHTML;
						copyBtn.innerHTML = '<i class="fas fa-check"></i> Copied!';
						copyBtn.style.background = '#2ecc71';
						copyBtn.style.color = 'white';
						copyBtn.style.borderColor = '#2ecc71';
						
						setTimeout(() => {
							copyBtn.innerHTML = originalContent;
							copyBtn.style.background = '';
							copyBtn.style.color = '';
							copyBtn.style.borderColor = '';
						}, 2000);
					} catch (err2) {
						showError('Unable to copy text. Please try selecting and copying manually (Ctrl/Cmd + C).');
					}
				}
			}

			// Add auto-switch functionality
			let autoSwitchEnabled = false;
			const autoSwitch = document.getElementById('autoSwitch');
			const DEFAULT_MODELS = [
				'deepseek/deepseek-chat-v3-0324',  // DeepSeek V3
				'google/gemini-2.0-flash-001'      // Gemini 2.0 Flash
			];
			
			function switchToNextModel() {
				const modelSelect = document.getElementById('modelSelect');
				const options = modelSelect.options;
				let currentIndex = modelSelect.selectedIndex;
				currentIndex = (currentIndex + 1) % options.length;
				modelSelect.selectedIndex = currentIndex;
				// Save the current selection to localStorage
				localStorage.setItem('selectedModel', modelSelect.value);
			}

			function setDefaultModel() {
				const modelSelect = document.getElementById('modelSelect');
				// Randomly select between DeepSeek V3 and Gemini 2.0 Flash
				const defaultModel = DEFAULT_MODELS[Math.floor(Math.random() * DEFAULT_MODELS.length)];
				modelSelect.value = defaultModel;
				localStorage.setItem('selectedModel', defaultModel);
			}
			
			// Event listener for auto-switch toggle
			autoSwitch.addEventListener('change', function() {
				autoSwitchEnabled = this.checked;
				localStorage.setItem('autoSwitchEnabled', autoSwitchEnabled.toString());
				
				// If auto-switch is turned off, set to default model
				if (!autoSwitchEnabled) {
					setDefaultModel();
				}
			});
			
			// Load saved preferences
			document.addEventListener('DOMContentLoaded', function() {
				const savedModel = localStorage.getItem('selectedModel');
				const savedAutoSwitch = localStorage.getItem('autoSwitchEnabled') === 'true';
				
				if (savedAutoSwitch) {
					document.getElementById('autoSwitch').checked = true;
					autoSwitchEnabled = true;
				} else {
					// If auto-switch is off and no saved model, set default
					if (!savedModel) {
						setDefaultModel();
					} else {
						// If saved model exists but isn't one of the defaults, set default
						if (!DEFAULT_MODELS.includes(savedModel)) {
							setDefaultModel();
						} else {
							document.getElementById('modelSelect').value = savedModel;
						}
					}
				}
			});
			
			// Update localStorage when model is manually changed
			document.getElementById('modelSelect').addEventListener('change', function() {
				localStorage.setItem('selectedModel', this.value);
			});

			// Add new variables for chat functionality
			let chatHistory = [];
			let currentThread = null;

			// Function to format timestamp
			function formatTimestamp() {
				return new Date().toLocaleTimeString();
			}

			// Function to create message element
			function createMessageElement(content, isUser = false, timestamp = null, model = null) {
				const messageDiv = document.createElement('div');
				messageDiv.className = `message ${isUser ? 'user' : 'assistant'}`;
				const avatar = document.createElement('div');
				avatar.className = 'message-avatar';
				avatar.innerHTML = isUser ? '👤' : '🤖';
				const contentDiv = document.createElement('div');
				contentDiv.className = 'message-content';
				if (!isUser && model) {
					const modelDiv = document.createElement('div');
					modelDiv.className = 'message-model';
					modelDiv.textContent = model;
					contentDiv.appendChild(modelDiv);
				}
				contentDiv.innerHTML += marked.parse(content);
				// Highlight code blocks
				setTimeout(() => {
					contentDiv.querySelectorAll('pre code').forEach(block => {
						hljs.highlightElement(block);
					});
				}, 0);
				const timestampDiv = document.createElement('div');
				timestampDiv.className = 'message-timestamp';
				timestampDiv.textContent = timestamp || formatTimestamp();
				const actionsDiv = document.createElement('div');
				actionsDiv.className = 'message-actions';
				const copyBtn = document.createElement('button');
				copyBtn.className = 'message-action-btn';
				copyBtn.innerHTML = '<i class="fas fa-copy"></i>';
				copyBtn.onclick = () => copyMessage(content);
				const threadBtn = document.createElement('button');
				threadBtn.className = 'message-action-btn';
				threadBtn.innerHTML = '<i class="fas fa-reply"></i>';
				threadBtn.onclick = () => startNewThread(content);
				actionsDiv.appendChild(copyBtn);
				actionsDiv.appendChild(threadBtn);
				messageDiv.appendChild(avatar);
				messageDiv.appendChild(contentDiv);
				messageDiv.appendChild(timestampDiv);
				messageDiv.appendChild(actionsDiv);
				return messageDiv;
			}

			// Function to copy message
			function copyMessage(content) {
				navigator.clipboard.writeText(content).then(() => {
					// Show success feedback
					const copyBtn = document.querySelector('.message-action-btn');
					const originalContent = copyBtn.innerHTML;
					copyBtn.innerHTML = '<i class="fas fa-check"></i>';
					setTimeout(() => {
						copyBtn.innerHTML = originalContent;
					}, 2000);
				});
			}

			// Function to start new thread
			function startNewThread(content) {
				currentThread = {
					parentMessage: content,
					messages: []
				};
				// Add thread indicator
				const threadIndicator = document.createElement('div');
				threadIndicator.className = 'thread-indicator';
				threadIndicator.innerHTML = `<i class="fas fa-reply"></i> Replying to previous message`;
				document.getElementById('chatContainer').appendChild(threadIndicator);
			}

			// Update sendMessage function
			async function sendMessage() {
				const input = document.getElementById('userInput').value.trim();
				
				if (!input) {
					showError('Please enter a message.');
					return;
				}

				// Add user message to chat
				const userMessage = createMessageElement(input, true);
				document.getElementById('chatContainer').appendChild(userMessage);

				// Switch to next model if auto-switch is enabled
				if (autoSwitchEnabled) {
					switchToNextModel();
				}

				const selectedModel = document.getElementById('modelSelect').value;
				
				showTyping();
				
				try {
					const response = await fetch('https://openrouter.ai/api/v1/chat/completions', {
						method: 'POST',
						headers: {
							'Authorization': `Bearer ${API_KEYS[selectedModel]}`,
							'Content-Type': 'application/json',
							'HTTP-Referer': 'https://openrouter.ai/docs',
							'X-Title': 'Go Gt Ai'
						},
						body: JSON.stringify({
							model: selectedModel,
							messages: [{
								role: 'user',
								content: input
							}],
							temperature: 0.7,
							max_tokens: 4000
						})
					});

					const data = await response.json();
					
					if (!response.ok) {
						throw new Error(data.error?.message || 'Failed to get response from AI');
					}

					const messageContent = data.choices?.[0]?.message?.content;

					if (!messageContent) {
						throw new Error('Empty response received from AI');
					}

					// Add AI response to chat, show model name
					const aiMessage = createMessageElement(messageContent, false, null, selectedModel);
					document.getElementById('chatContainer').appendChild(aiMessage);

					// Update chat history (push only the new message pair)
					chatHistory.push({
						user: input,
						assistant: messageContent,
						timestamp: new Date().toISOString(),
						model: selectedModel
					});

					// Save chat history to localStorage
					localStorage.setItem('chatHistory', JSON.stringify(chatHistory));

					hideTyping();
					document.getElementById('userInput').value = '';

					// Scroll to bottom
					document.getElementById('chatContainer').scrollTo({ top: document.getElementById('chatContainer').scrollHeight, behavior: 'smooth' });

				} catch (error) {
					console.error('Full error:', error);
					hideTyping();
					showError(typeof error === 'string' ? error : error.message || 'Failed to get response. Please try again.');
				}
			}

			// Load chat history on page load
			document.addEventListener('DOMContentLoaded', function() {
				const savedHistory = localStorage.getItem('chatHistory');
				const chatContainer = document.getElementById('chatContainer');
				// Clear chat container before loading history
				chatContainer.innerHTML = '';
				if (savedHistory) {
					chatHistory = JSON.parse(savedHistory);
					// Display chat history
					chatHistory.forEach(chat => {
						const userMessage = createMessageElement(chat.user, true, new Date(chat.timestamp).toLocaleTimeString(), chat.model);
						const aiMessage = createMessageElement(chat.assistant, false, new Date(chat.timestamp).toLocaleTimeString(), chat.model);
						chatContainer.appendChild(userMessage);
						chatContainer.appendChild(aiMessage);
					});
				}
			});

			// Debounce function to prevent rapid-fire API calls
			function debounce(func, wait) {
				let timeout;
				return function executedFunction(...args) {
					const later = () => {
						clearTimeout(timeout);
						func(...args);
					};
					clearTimeout(timeout);
					timeout = setTimeout(later, wait);
				};
			}

			// Debounced version of sendMessage
			const debouncedSendMessage = debounce(sendMessage, 300);

			// Handle Enter key with debounce
			document.getElementById('userInput').addEventListener('keypress', (event) => {
				if (event.key === 'Enter') {
					event.preventDefault();
					debouncedSendMessage();
				}
			});

			// Initialize marked with options for faster rendering
			marked.setOptions({
				breaks: true,
				gfm: true,
				headerIds: false, // Disable header IDs for faster rendering
				sanitize: false
			});

			// Focus input on page load
			document.getElementById('userInput').focus();

			// Theme switcher functionality
			const themeSwitch = document.getElementById('themeSwitch');
			
			// Function to set theme
			function setTheme(isDark) {
				document.documentElement.setAttribute('data-theme', isDark ? 'dark' : 'light');
				themeSwitch.checked = !isDark; // Invert the check state (checked = light mode)
				localStorage.setItem('theme', isDark ? 'dark' : 'light');
			}
			
			// Check for saved theme preference or use system preference
			document.addEventListener('DOMContentLoaded', () => {
				const savedTheme = localStorage.getItem('theme');
				if (savedTheme) {
					setTheme(savedTheme === 'dark');
				} else {
					const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
					setTheme(prefersDark);
				}
			});
			
			// Listen for theme toggle
			themeSwitch.addEventListener('change', (e) => {
				setTheme(!e.target.checked); // Invert the check state (checked = light mode)
			});
			
			// Listen for system theme changes
			window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', (e) => {
				if (!localStorage.getItem('theme')) {
					setTheme(e.matches);
				}
			});
		</script>
	</body>
</html>
